<?xml version='1.0' encoding='UTF-8' ?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<!-- Einbindung eines externen Stylesheets -->
<h:outputStylesheet library="css" name="style.css" />

<h:head>
	<title>Bergungserfolg melden</title>
</h:head>

<h:body>

	<!-- Einbindung der Menüleiste über Facelets -->
	<h:form>
		<ui:include src="menubar.xhtml" />
	</h:form>

	<!-- Kopfbereich mit Logo und Titel -->
	<div class="card">
		<h:panelGrid columns="2"
			style="vertical-align: middle; align-items: center;">
			<p:graphicImage name="whaleLogo.png" library="images" width="40" />
			<h:outputText value="Shea Sepherd – Ghost Net Fishing"
				styleClass="logoTitle" />
		</h:panelGrid>
	</div>

	<!-- Hauptbereich zur Meldung eines Bergungserfolgs -->
	<p:card style="width: 75%; padding: 50px;">
		<div
			style="display: flex; flex-direction: column; align-items: center; gap: 20px;">

			<div class="card"
				style="margin: 20px auto; width: 100%; max-width: 1000px;">
				<h:form>
					<!-- Formular zur Identifikation der Person -->
					<p:outputPanel id="personPanel" layout="block">
						<p:card>
							<f:facet name="title">Anmelden um Bergungserfolg zu melden</f:facet>

							<h:panelGroup layout="block"
								style="width: 350px; margin: 0 auto;">
								<div style="display: flex; flex-direction: column; gap: 20px;">

									<!-- Anmeldung über Personen-ID -->
									<p:divider align="center">
										<span class="ui-tag">Anmeldung über Ihre Personen-ID...</span>
									</p:divider>

									<div
										style="display: flex; justify-content: space-between; align-items: center;">
										<p:outputLabel value="Personen-ID (optional):" for="personId" />
										<p:inputText id="personId" value="#{personDAO.personId}"
											size="25" style="width: 200px;">

										</p:inputText>
									</div>

									<!-- Alternativ: Anmeldung über persönliche Daten -->
									<p:divider align="center">
										<span class="ui-tag">...oder über Ihre persönliche
											Daten.</span>
									</p:divider>

									<div
										style="display: flex; justify-content: space-between; align-items: center;">
										<p:outputLabel value="Vorname:" for="firstName" />
										<p:inputText id="firstName"
											value="#{personDAO.person.firstName}" size="25"
											style="width: 200px;">

										</p:inputText>
									</div>
									<div
										style="display: flex; justify-content: space-between; align-items: center;">
										<p:outputLabel value="Nachname:" for="lastName" />
										<p:inputText id="lastName"
											value="#{personDAO.person.lastName}" size="25"
											style="width: 200px;">
										</p:inputText>
									</div>

									<!-- Telefonnummer mit Validierung -->
									<div
										style="display: flex; justify-content: space-between; align-items: center;">
										<p:outputLabel value="Telefon:" for="phoneNumber" />
										<p:inputText id="phoneNumber"
											value="#{personDAO.person.phoneNumber}" size="25"
											style="width: 200px;">
											<f:validateRegex pattern="^\+?[0-9\s\-]{7,15}$" />
										</p:inputText>
									</div>

									<!-- Anzeige einer neuen Personen-ID, falls vergeben -->
									<h:outputText value="Neue Personen-ID: #{netzDAO.newPersonId}"
										rendered="#{netzDAO.newPersonId != null}" />
								</div>
								<p:commandButton value="Person prüfen"
									action="#{netzDAO.checkPerson}" update="@form" />
							</h:panelGroup>
						</p:card>
					</p:outputPanel>

					<!-- Anzeige von System- und Validierungsmeldungen -->
					<p:messages autoUpdate="true" showDetail="false" />

					<!-- Tabelle mit Netzen, die zur Bergung angemeldet sind -->
					<p:dataTable value="#{netzDAO.getAllNets('Bergung bevorstehend')}"
						var="nets"
						style="width: 100%; max-width: 1000px; margin: 20px auto"
						paginator="true" rows="10">

						<!-- Button zur Bestätigung des Bergungserfolgs -->
						<p:column headerText="Aktion">
							<p:commandButton value="Bergung erfolgreich"
								action="#{netzDAO.selectNet(nets, 'geborgen')}" update="@form"
								disabled="#{!netzDAO.personValid}" />
						</p:column>

						<!-- Anzeige der Netzdetails -->
						<p:column headerText="ID">
							<h:outputText value="#{nets.id}" />
						</p:column>

						<p:column headerText="Größe in m²">
							<h:outputText value="#{nets.netSize}" />
						</p:column>

						<p:column headerText="Meldungsdatum">
							<h:outputText value="#{nets.notificationDate}" />
						</p:column>

						<p:column headerText="Breitengrad">
							<h:outputText
								value="#{nets.northSouth} #{nets.latituteDegree}°#{nets.latituteMinute}'#{nets.latituteSeconds}" />
						</p:column>

						<p:column headerText="Längengrad">
							<h:outputText
								value="#{nets.eastWest} #{nets.longituteDegree}°#{nets.longituteMinute}'#{nets.longituteSeconds}" />
						</p:column>
					</p:dataTable>
				</h:form>
			</div>
		</div>
	</p:card>
</h:body>
</html>

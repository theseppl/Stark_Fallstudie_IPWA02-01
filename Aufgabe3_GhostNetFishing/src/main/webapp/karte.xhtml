<?xml version='1.0' encoding='UTF-8' ?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">

<h:outputStylesheet library="css" name="style.css" />

<h:head>
    <title>Karte – Geisternetz Fundorte</title>
</h:head>

<h:body>

    <!-- Menüleiste -->
    <h:form>
        <ui:include src="menubar.xhtml" />
    </h:form>

    <!-- Logo und Titel -->
    <div class="card">
        <h:panelGrid columns="2" style="vertical-align: middle; align-items: center;">
            <p:graphicImage name="whaleLogo.png" library="images" width="40" />
            <h:outputText value="Shea Sepherd – Ghost Net Fishing" styleClass="logoTitle" />
        </h:panelGrid>
    </div>

    <!-- Kartenbereich -->
    <div class="card" style="margin: 20px">
        <p:growl id="messages" showDetail="true" />

        <p:gmap id="gmap" center="52.890257,10.707417" zoom="5" type="ROADMAP"
                style="width:100%;height:400px"
                model="#{addMarkersView.emptyModel}"
                onPointClick="handlePointClick(event);" widgetVar="map" />
    </div>

    <!-- Dialog zur Marker-Erfassung -->
    <p:dialog widgetVar="dlg" showEffect="fade" header="Fundort erfassen">
        <h:form prependId="false">
            <h:panelGrid columns="2">
                <h:outputLabel for="title" value="Beschreibung:" />
                <p:inputText id="title" value="#{addMarkersView.title}" />

                <f:facet name="footer">
                    <p:commandButton value="Speichern" action="#{addMarkersView.addMarker}" update=":messages"
                                     oncomplete="markerAddComplete()" />
                    <p:commandButton value="Abbrechen" onclick="return cancel()" />
                </f:facet>
            </h:panelGrid>

            <h:inputHidden id="lat" value="#{addMarkersView.lat}" />
            <h:inputHidden id="lng" value="#{addMarkersView.lng}" />
        </h:form>
    </p:dialog>

    <!-- Google Maps API -->
    <script src="https://maps.google.com/maps/api/js?key=AIzaSyCvCDkYieuUBmMWon_mfLAfjuaeuosuqow&amp;sensor=true"></script>
    <script>
        var currentMarker = null;

        function handlePointClick(event) {
            if (currentMarker === null) {
                document.getElementById('lat').value = event.latLng.lat();
                document.getElementById('lng').value = event.latLng.lng();

                currentMarker = new google.maps.Marker({
                    position: new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
                });

                PF('map').addOverlay(currentMarker);
                PF('dlg').show();
            }
        }

        function markerAddComplete() {
            var title = document.getElementById('title');
            currentMarker.setTitle(title.value);
            title.value = "";

            currentMarker = null;
            PF('dlg').hide();
        }

        function cancel() {
            PF('dlg').hide();
            currentMarker.setMap(null);
            currentMarker = null;
            return false;
        }
    </script>

</h:body>
</html>
